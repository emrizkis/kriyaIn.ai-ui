<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - KriyaIn.ai</title>

    <!-- Memasukkan library Leaflet.js untuk peta interaktif -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Menggunakan Tailwind CSS untuk styling yang cepat dan responsif -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Menggunakan Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Inter', sans-serif;
        }
        #map {
            height: 100%;
            width: 100%;
            background-color: #f0f0f0; 
        }
        /* Custom scrollbar untuk area chat */
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 3px;
        }
        .chat-messages::-webkit-scrollbar-thumb:hover {
            background: #bbb;
        }
        /* Style untuk highlight wilayah di peta */
        .geojson-highlight {
            weight: 3;
            color: #0056b3;
            fillColor: #007bff;
            fillOpacity: 0.3;
        }
    </style>
</head>
<body class="font-sans">

    <div class="flex h-screen w-screen bg-gray-100">
        
        <!-- Kolom Kiri: Peta Interaktif -->
        <main class="flex-grow h-full">
            <div id="map"></div>
        </main>

        <!-- Kolom Kanan: Sidebar Chat BARU -->
        <aside class="w-full md:w-2/5 lg:w-1/3 h-full bg-white flex flex-col flex-shrink-0 border-l border-gray-200">
            
            <!-- Area Pesan Chat -->
            <div id="chat-messages" class="chat-messages flex-grow p-4 overflow-y-auto">
                <!-- Contoh Percakapan -->
                <div class="message-user mb-4 flex justify-end">
                    <div class="bg-blue-600 p-3 rounded-lg text-white max-w-xs shadow">
                        <p>Apa informasi tentang Tanjung Jabung?</p>
                    </div>
                </div>
                <div class="message-ai mb-4 flex">
                    <div class="bg-gray-200 p-3 rounded-lg text-gray-800">
                        <p><strong>Tanjung Jabung Barat</strong> adalah sebuah kabupaten di <strong>Provinsi Jambi</strong>, Indonesia. Koordinat wilayah ini sekitar 1.1358째 LS, 103.0636째 BT. Kerajinan khas daerah ini antara lain: "Anyaman purun", anyaman dari tumbuhan purun untuk membuat tikar dan tas. "Kerajinan batik Jambi", motif khas seperti durian pecah dan kapal sanggat. "Kerajinan rotan dan bambu", digunakan untuk membuat perabotan rumah tangga.</p>
                    </div>
                </div>
                 <div class="message-user mb-4 flex justify-end">
                    <div class="bg-blue-600 p-3 rounded-lg text-white max-w-xs shadow">
                        <p>Apa informasi tentang Ketapang?</p>
                    </div>
                </div>
                <div class="message-ai mb-4 flex">
                    <div class="bg-gray-200 p-3 rounded-lg text-gray-800">
                        <p><strong>Ketapang</strong> adalah sebuah kabupaten di <strong>Provinsi Kalimantan Barat</strong>, Indonesia. Terletak di koordinat sekitar 1.850째 LS, 109.966째 BT. Kerajinan khas Ketapang antara lain: Anyaman rotan dan bambu, Tenun ikat khas Dayak, Kerajinan manik-manik dan hiasan tradisional suku Dayak.</p>
                    </div>
                </div>
            </div>

            <!-- Area Input Chat -->
            <div class="chat-input p-4 border-t border-gray-200 bg-white">
                <div class="relative flex items-center">
                    <input type="text" class="w-full bg-gray-100 border border-gray-300 rounded-lg p-3 pr-16 focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Ketik pesan..." />
                    <button class="absolute right-2 bg-blue-600 p-2 rounded-md text-white hover:bg-blue-700" title="Kirim">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.428A1 1 0 009.894 15V4.106A1 1 0 0010.894 2.553z" />
                        </svg>
                    </button>
                </div>
            </div>
        </aside>

    </div>

    <script>
        // Inisialisasi Peta Leaflet
        var map = L.map('map').setView([-2.5, 118.0], 5);
        var geojsonLayer;
        var lastClickedLayer;

        // Menambahkan Tile Layer dari OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Fungsi untuk menambahkan pesan baru ke chat
        function addMessageToChat(text, type) {
            const chatMessages = document.getElementById('chat-messages');
            const messageContainer = document.createElement('div');
            
            if (type === 'user') {
                messageContainer.className = 'message-user mb-4 flex justify-end';
                messageContainer.innerHTML = `<div class="bg-blue-600 p-3 rounded-lg text-white max-w-xs shadow"><p>${text}</p></div>`;
            } else {
                messageContainer.className = 'message-ai mb-4 flex';
                messageContainer.innerHTML = `<div class="bg-gray-200 p-3 rounded-lg text-gray-800"><p>${text}</p></div>`;
            }
            
            chatMessages.appendChild(messageContainer);
            chatMessages.scrollTop = chatMessages.scrollHeight; // Auto scroll ke bawah
        }

        // Fungsi yang dijalankan saat sebuah wilayah di peta diklik
        function onRegionClick(e) {
            var layer = e.target;
            var props = layer.feature.properties;
            var regionName = props.state || props.name || 'wilayah ini';

            // Reset style layer yang diklik sebelumnya
            if (lastClickedLayer) {
                geojsonLayer.resetStyle(lastClickedLayer);
            }
            
            // Beri highlight pada layer yang baru diklik
            layer.setStyle({
                weight: 3,
                color: '#0056b3',
                fillOpacity: 0.5
            });
            lastClickedLayer = layer;

            // Tambahkan pesan ke chat
            addMessageToChat(`Tolong berikan informasi tentang ${regionName}.`, 'user');
            addMessageToChat(`Tentu! Mencari informasi untuk <strong>${regionName}</strong>... (Ini adalah contoh, data AI belum terhubung)`, 'ai');

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
        }

        // Memuat dan menampilkan data GeoJSON untuk wilayah Indonesia
        fetch('https://raw.githubusercontent.com/superpikar/indonesia-geojson/master/indonesia-province.json')
            .then(response => response.json())
            .then(data => {
                geojsonLayer = L.geoJson(data, {
                    style: {
                        color: "#007bff",
                        weight: 1,
                        opacity: 0.65,
                        fillColor: "#007bff",
                        fillOpacity: 0.1
                    },
                    onEachFeature: function(feature, layer) {
                        layer.on({
                            click: onRegionClick
                        });
                    }
                }).addTo(map);
            })
            .catch(error => console.error('Error loading GeoJSON:', error));

    </script>

</body>
</html>
